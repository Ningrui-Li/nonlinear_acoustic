LS-DYNA Shear Wave Simulation Code
==================================
## Intensity Field Generation
The intensity field must first be generated by running Field II, KZK, or k-Wave sims. The parameters used for the Field II simulation can be found [here](https://github.com/Ningrui-Li/nonlinear_acoustic/tree/master/field). The Field II synthesized face pressure inputs used for the KZK simulations can be found at `/luscinia/nl91/nonlinear_acoustic/kzk/field_ii_c52_30mm_pressure_input.mat` for the 30 mm focal depth case and `/luscinia/nl91/nonlinear_acoustic/kzk/field_ii_c52_focus70mm/field_ii_c52_70mm_pressure_input.mat` for the 70 mm focal depth case.

## Mesh Generation
The `mesh` folder contains information on how the mesh was generated for running the LS-DYNA simulation. The mesh used for the 30 mm focal depth simulation has quarter symmetry, so it is defined from 0 cm to 1.2 cm laterally, -0.6 cm to 0.0 cm in elevation, and 0 cm to 5.2 cm in depth. The mesh used for the 70 mm focal depth simulation is defined from 0 cm to 2.0 cm laterally, -0.6 cm to 0.0 cm in elevation, and 0 cm to 9.0 cm in depth. For both cases, spacing between axial nodes is 0.025 cm, while spacing between lateral and elevational nodes is 0.020 cm. 

## Running LS-DYNA
In order to use the FEM code to create `loads.dyn`, generated intensity fields must be moulded to look like the MAT file output from `field2dyna.m`. This can be done using the scripts in `/luscinia/nl91/nonlinear_acoustic/dyna/loads/`. First, we assume that the intensity fields output from the KZK sim is a MAT file that contains the `intensity` matrix (with dimensions axial x lateral x elevational) as well as three vectors, `depth`, `ele`, and `lat` that respectively contain the axial positions, elevational positions, and lateral positions of the intensity matrix values.

The function `kzk_to_dyna.m` takes in the file name of this intensity field, as well as the attenuation value used (in dB/cm/MHz) and the lateral and elevational extents of the mesh. These lateral and elevational extents do not necessarily have to include the entire intensity field. It also takes in the F/# and focal depth of the transducer. Currently, this function is hard-coded to the excitation frequency of the C5-2 (2.36 MHz), but this can be easily changed. This function formats the intensity field to match Field II dimensions. The intensity field is made quarter symmetric. It is also interpolated to have uniform nodal spacing with spacings hard-coded to match the generated mesh. The axial, lateral, and elevational limits determine the size of the interpolated intensity field. The output is saved to `dyna-kzk.mat`, which is equivalent to the `field2dyna.m` output file.
